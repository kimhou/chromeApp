(function(){	var mod = {		init: function(){			mod.render();			mod.bind();		},		render: function(){			mod.doms = {				urlQrResult: $('#url_qr_result'),				copyQrResult: $('#copy_qr_result'),				copyQrInput: $('#copy_input'),				copyResetBtn: $('#copy_reset_btn'),				cardSubmitBtn: $('#card_submit_btn'),				cardQrResult: $('#card_qr_result')			};			chrome.tabs.getSelected(null, function(tab){				mod.doms.urlQrResult.qrcode({					text: tab.url,					width: 150,					height: 150				});				$('li.content:first').show();			});		},		bind: function(){			$('ul.list').delegate('li.title', 'click', function(e){				e.preventDefault();				var title = $(this),					targetCt = title.next('li.content:first');								$('li.content:visible').each(function(i, n){					if($(n).html() != targetCt.html() ){						$(n).slideUp();					}				});				targetCt.slideToggle(function(){					if(title.attr('id') == 'copy-qr-title' && targetCt.is(':visible') && !$.trim(mod.doms.copyQrInput.val())){						mod.doms.copyQrInput.val('').select();						if(!document.execCommand('paste')){							alert('paste failed');						}						mod.generateCustomerQr();					}				});			});			mod.doms.copyResetBtn.click(function(){				mod.generateCustomerQr();			});			mod.doms.cardSubmitBtn.click(function(){				var str = mod.getCardStr({					name: $.trim($('#card-name').val()),					mobile: $.trim($('#card-mobile').val()),					phone: $.trim($('#card-phone').val()),					email: $.trim($('#card-email').val()),					company: $.trim($('#card-company').val()),					address: $.trim($('#card-address').val())				});				str && mod.doms.cardQrResult.html('').qrcode({					text: mod.utf16to8(str),					width: 150,					height: 150,					correctLevel: 0				});			});		},		generateCustomerQr: function(){			var val = $.trim(mod.doms.copyQrInput.val());			val && mod.doms.copyQrResult.html('').qrcode({					text: mod.utf16to8(val),					width: 150,					height: 150,					correctLevel: 0			});		},		utf16to8: function(str) {			var out, i, len, c;			out = "";			len = str.length;			for(i = 0; i < len; i++) {			c = str.charCodeAt(i);			if ((c >= 0x0001) && (c <= 0x007F)) {				out += str.charAt(i);			} else if (c > 0x07FF) {				out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));				out += String.fromCharCode(0x80 | ((c >>  6) & 0x3F));				out += String.fromCharCode(0x80 | ((c >>  0) & 0x3F));			} else {				out += String.fromCharCode(0xC0 | ((c >>  6) & 0x1F));				out += String.fromCharCode(0x80 | ((c >>  0) & 0x3F));			}			}			return out;		},		getCardStr: function(data){			if(!data.name){				alert('please input name');				return false;			}			return [				'BEGIN:VCARD',				'VERSION:2.1',				data.name ? 'FN:' + data.name : '',				data.company ? 'ORG:' + data.company : '',				data.title ? 'TITLE:' + data.title : '',				data.mobile ? 'TEL;CELL;VOICE:' + data.mobile : '',				data.phone ? 'TEL;WORK;VOICE:' + data.phone : '',				data.address ? 'ADR:' + data.address : '',				data.email ? 'EMAIL;PREF;INTERNET:' + data.email : '',				'REV:20080424T195243Z',				'END:VCARD'			].join('\n');		}	}; 	mod.init();})();